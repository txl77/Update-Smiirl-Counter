name: Get followers and update npoint
  run: |
    node << 'EOF'
    const { chromium } = require('playwright');
    (async () => {
      try {
        const browser = await chromium.launch();
        const page = await browser.newPage();
        await page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36');
        await page.goto('https://www.instagram.com/uefrance/');
        await page.waitForSelector('header');
        await page.waitForTimeout(5000);

        const content = await page.content();
        const jsonMatch = content.match(/window\._sharedData\s*=\s*({.*?});/);

        if (jsonMatch) {
          const data = JSON.parse(jsonMatch[1]);
          const followers = data.entry_data.ProfilePage[0].graphql.user.edge_followed_by.count;
          console.log('Followers found:', followers);

          const response = await fetch('https://api.npoint.io/5c1ef38596efbfb2bfe9', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({number: followers})
          });

          if (!response.ok) throw new Error('Failed to update npoint');
          console.log('npoint updated successfully!');
        } else {
          console.error('Could not find shared data in page content');
          process.exit(1);
        }

        await browser.close();
      } catch (error) {
        console.error('Error:', error);
        process.exit(1);
      }
    })();
    EOF
