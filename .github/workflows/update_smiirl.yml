NPOINT_URL="https://api.npoint.io/5c1ef38596efbfb2bfe9"

echo "Fetching followers for @uefrance"

# 1️⃣ Tentative via endpoint JSON
FOLLOWERS=$(curl -s \
  -H "User-Agent: Mozilla/5.0" \
  "https://www.instagram.com/uefrance/?__a=1&__d=dis" \
  | grep -oP '"follower_count":\K[0-9]+')

# 2️⃣ Fallback HTML si bloqué
if [ -z "$FOLLOWERS" ]; then
  echo "⚠️ __a=1 failed, falling back to HTML scraping"

  FOLLOWERS=$(curl -s \
    -H "User-Agent: Mozilla/5.0" \
    "https://www.instagram.com/uefrance/" \
    | grep -oP '"edge_followed_by":\{"count":\K[0-9]+')
fi

# 3️⃣ Vérification finale
if [ -z "$FOLLOWERS" ]; then
  echo "❌ Failed to fetch followers via all methods"
  exit 1
fi

echo "Followers: $FOLLOWERS"

# 4️⃣ Update npoint
curl -s -X POST "$NPOINT_URL" \
  -H "Content-Type: application/json" \
  -d "{\"number\": $FOLLOWERS}"

echo "✅ npoint updated successfully"
