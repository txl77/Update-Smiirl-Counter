name: Update Smiirl Counter with Twitter Followers

on:
  schedule:
    - cron: '0 10 * * *'  # Tous les jours à 10h (heure de Paris)
  workflow_dispatch:  # Permet de lancer manuellement

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Get Twitter followers and update npoint
        run: |
          # Installer les outils nécessaires
          sudo apt-get update
          sudo apt-get install -y curl jq

          # Récupérer le nombre d'abonnés depuis l'API Twitter (via un service tiers)
          # Utilisation de l'API publique de Twitter (nécessite un Bearer Token)
          # Pour obtenir un token: https://developer.twitter.com/en/portal/projects-and-apps

          # Méthode alternative sans token (via un service tiers public)
          FOLLOWERS=$(curl -s "https://cdn.syndication.twimg.com/widget/followbutton/info.json?screen_names=UEFrance" | \
                     jq -r '.[] | select(.screen_name=="UEFrance") | .followers_count')

          if [ -z "$FOLLOWERS" ] || [ "$FOLLOWERS" = "null" ]; then
            echo "Erreur: Impossible de récupérer le nombre d'abonnés depuis Twitter"
            exit 1
          fi

          echo "Nombre d'abonnés Twitter: $FOLLOWERS"

          # Mettre à jour npoint.io
          RESPONSE=$(curl -s -X POST "https://api.npoint.io/5c1ef38596efbfb2bfe9" \
                    -H "Content-Type: application/json" \
                    -d "{\"number\": $FOLLOWERS}")

          echo "npoint.io mis à jour avec succès!"
          echo "Réponse de l'API: $RESPONSE"
